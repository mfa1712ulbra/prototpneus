{
  "entities": {
    "Usuario": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Usuario",
      "type": "object",
      "description": "Entidade que armazena informações dos usuários do sistema.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para o usuário."
        },
        "nome": {
          "type": "string",
          "description": "Nome completo do usuário."
        },
        "email": {
          "type": "string",
          "description": "Endereço de email do usuário.",
          "format": "email"
        },
        "tipo": {
          "type": "string",
          "description": "Tipo de usuário (gerente ou técnico)."
        }
      },
      "required": [
        "id",
        "nome",
        "email",
        "tipo"
      ]
    },
    "Veiculo": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Veiculo",
      "type": "object",
      "description": "Entidade que armazena informações dos veículos.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para o veículo."
        },
        "placa": {
          "type": "string",
          "description": "Número da placa do veículo."
        },
        "modelo": {
          "type": "string",
          "description": "Modelo do veículo."
        },
        "marca": {
          "type": "string",
          "description": "Marca do veículo."
        }
      },
      "required": [
        "id",
        "placa",
        "modelo",
        "marca"
      ]
    },
    "Pneu": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pneu",
      "type": "object",
      "description": "Entidade que armazena informações dos pneus.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para o pneu."
        },
        "veiculoId": {
          "type": "string",
          "description": "Referência para o Veiculo. (Relacionamento: Veiculo 1:N Pneu)"
        },
        "posicao": {
          "type": "string",
          "description": "Posição do pneu no veículo (ex: dianteiro esquerdo)."
        },
        "pressao": {
          "type": "number",
          "description": "Pressão atual do pneu."
        },
        "profundidade": {
          "type": "number",
          "description": "Profundidade do piso do pneu."
        },
        "observacoes": {
          "type": "string",
          "description": "Observações sobre o pneu."
        }
      },
      "required": [
        "id",
        "veiculoId",
        "posicao",
        "pressao",
        "profundidade"
      ]
    },
    "Movimentacao": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Movimentacao",
      "type": "object",
      "description": "Entidade que armazena o histórico de movimentações dos pneus.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Identificador único para a movimentação."
        },
        "pneuId": {
          "type": "string",
          "description": "Referência para o Pneu. (Relacionamento: Pneu 1:N Movimentacao)"
        },
        "data": {
          "type": "string",
          "description": "Data da movimentação.",
          "format": "date-time"
        },
        "tipo": {
          "type": "string",
          "description": "Tipo de movimentação (ex: rotação, recapagem, descarte)."
        },
        "descricao": {
          "type": "string",
          "description": "Descrição da movimentação."
        }
      },
      "required": [
        "id",
        "pneuId",
        "data",
        "tipo"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/usuarios/{usuarioId}",
        "definition": {
          "entityName": "Usuario",
          "schema": {
            "$ref": "#/backend/entities/Usuario"
          },
          "description": "Armazena informações dos usuários do sistema.",
          "params": [
            {
              "name": "usuarioId",
              "description": "Identificador único do usuário."
            }
          ]
        }
      },
      {
        "path": "/usuarios/{usuarioId}/veiculos/{veiculoId}",
        "definition": {
          "entityName": "Veiculo",
          "schema": {
            "$ref": "#/backend/entities/Veiculo"
          },
          "description": "Armazena informações dos veículos de cada usuário. Garante o relacionamento 1:N entre usuários e veículos.",
          "params": [
            {
              "name": "usuarioId",
              "description": "Identificador único do usuário."
            },
            {
              "name": "veiculoId",
              "description": "Identificador único do veículo."
            }
          ]
        }
      },
      {
        "path": "/usuarios/{usuarioId}/veiculos/{veiculoId}/pneus/{pneuId}",
        "definition": {
          "entityName": "Pneu",
          "schema": {
            "$ref": "#/backend/entities/Pneu"
          },
          "description": "Armazena informações dos pneus de cada veículo. Inclui 'veiculoId' denormalizado para independência de autorização.",
          "params": [
            {
              "name": "usuarioId",
              "description": "Identificador único do usuário."
            },
            {
              "name": "veiculoId",
              "description": "Identificador único do veículo."
            },
            {
              "name": "pneuId",
              "description": "Identificador único do pneu."
            }
          ]
        }
      },
      {
        "path": "/usuarios/{usuarioId}/veiculos/{veiculoId}/pneus/{pneuId}/movimentacoes/{movimentacaoId}",
        "definition": {
          "entityName": "Movimentacao",
          "schema": {
            "$ref": "#/backend/entities/Movimentacao"
          },
          "description": "Armazena o histórico de movimentações dos pneus. Garante o relacionamento 1:N entre pneus e movimentações.",
          "params": [
            {
              "name": "usuarioId",
              "description": "Identificador único do usuário."
            },
            {
              "name": "veiculoId",
              "description": "Identificador único do veículo."
            },
            {
              "name": "pneuId",
              "description": "Identificador único do pneu."
            },
            {
              "name": "movimentacaoId",
              "description": "Identificador único da movimentação."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to manage vehicle and tire information efficiently, catering specifically to the TireControl application's requirements. It prioritizes authorization independence and clear data relationships. The structure leverages path-based ownership for user-specific data and employs denormalization to avoid complex security rules that rely on `get()` calls. \n\n*   `/usuarios/{usuarioId}`: Stores user data. This collection is at the root level, allowing easy access to user profiles. Each user document is identified by a unique `usuarioId`.\n*   `/usuarios/{usuarioId}/veiculos/{veiculoId}`:  Stores vehicle data owned by each user. The `veiculos` subcollection is nested under each user, reflecting the 1:N relationship between users and vehicles. This structure clearly establishes ownership and simplifies security rules. This structure provides clear ownership.\n*   `/usuarios/{usuarioId}/veiculos/{veiculoId}/pneus/{pneuId}`: Stores tire data associated with each vehicle. Nested under the `veiculos` subcollection, it represents the 1:N relationship between vehicles and tires. This structure maintains clear ownership from user down to tires and simplifies security rules. Includes `veiculoId` denormalized from parent to enable authorization independence. This structure provides clear ownership.\n*   `/usuarios/{usuarioId}/veiculos/{veiculoId}/pneus/{pneuId}/movimentacoes/{movimentacaoId}`: Stores tire movement history for each tire. This subcollection provides a detailed log of all tire-related activities and simplifies querying the history.\n\nThis structure ensures authorization independence by avoiding the need for `get()` calls in security rules. Each document contains sufficient information within its path to determine access control. QAPs are supported through structural segregation, ensuring that listing operations can be secured based on path-based ownership."
  }
}